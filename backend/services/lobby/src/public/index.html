<!DOCTYPE html>
<html>
<head>
  <title>Main Menu</title>
  <style>
    /* Add your custom CSS styles here */
  </style>
</head>
<body>
  <h1>Main Menu</h1>
  <div id="lobbyList">
    <h2>Lobbies:</h2>
    <ul id="lobbies"></ul>
  </div>
  <div id="createLobby">
    <h2>Create Lobby:</h2>
    <form id="createLobbyForm">
      <input type="text" id="lobbyNameInput" placeholder="Lobby Name" required />
      <button type="submit">Create</button>
    </form>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    // Function to update the lobby list
    function updateLobbyList(lobbies) {
      const lobbyList = document.getElementById('lobbies');
      lobbyList.innerHTML = '';
      lobbies.forEach((lobby) => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `/lobbies/${lobby.id}`;
        link.textContent = lobby.name;
        li.appendChild(link);
        lobbyList.appendChild(li);
      });
    }

    // Function to fetch the lobby list from the server
    function fetchLobbyList() {
      fetch('/api/lobbies')
        .then((response) => response.json())
        .then((lobbies) => {
          updateLobbyList(lobbies);
        })
        .catch((error) => {
          console.error('Failed to fetch lobby list:', error);
        });
    }

    // Function to handle the create lobby form submission
    function handleCreateLobbyFormSubmit(event) {
      event.preventDefault();
      const lobbyNameInput = document.getElementById('lobbyNameInput');
      const name = lobbyNameInput.value;
      lobbyNameInput.value = '';
      fetch('/api/lobbies', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ name })
      })
        .then((response) => response.json())
        .then((data) => {
          console.log(data);
          const { message, lobbyId } = data;
          if (message === 'Lobby created successfully') {
            window.location.href = `/lobbies/${lobbyId}`;
          } else {
            console.error('Failed to create lobby:', message);
          }
        })
        .catch((error) => {
          console.error('Failed to create lobby:', error);
        });
    }

    // Event listener for the create lobby form submission
    document.getElementById('createLobbyForm').addEventListener('submit', handleCreateLobbyFormSubmit);

    // Listen for lobby updates
    socket.on('lobbyUpdated', (lobby) => {
      fetchLobbyList();
    });

    // Request the lobby list from the server upon page load
    fetchLobbyList();

    // Connect to the websocket server
    socket.on('connect', () => {
      console.log('Connected to websocket server');

      // Join the main menu lobby
      socket.emit('join', { lobbyId: 'mainMenu' });
    });

    // Disconnect from the websocket server
    socket.on('disconnect', () => {
      console.log('Disconnected from websocket server');
    });
  </script>
</body>
</html>