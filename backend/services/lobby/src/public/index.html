<!DOCTYPE html>
<html>
<head>
  <title>Main Menu</title>
  <style>
  </style>
</head>
<body>
  <h1>Main Menu</h1>
  <div id="lobbyList">
    <h2>Lobbies:</h2>
    <ul id="lobbies"></ul>
  </div>
  <div id="createLobby">
    <h2>Create Lobby:</h2>
    <form id="createLobbyForm">
      <input type="text" id="lobbyNameInput" placeholder="Lobby Name" required />
      <button type="submit">Create</button>
    </form>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    function updateLobbyList(lobbies) {
      const lobbyList = document.getElementById('lobbies');
      lobbyList.innerHTML = '';
      lobbies.forEach((lobby) => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `/lobbies/${lobby.id}`;
        link.textContent = lobby.name;
        li.appendChild(link);
        lobbyList.appendChild(li);
      });
    }

    function fetchLobbyList() {
      console.log('test123');
      fetch('/api/lobbies')
        .then((response) => response.json())
        .then((lobbies) => {
          updateLobbyList(lobbies);
        })
        .catch((error) => {
          console.error('Failed to fetch lobby list:', error);
        });
    }

    function handleCreateLobbyFormSubmit(event) {
      event.preventDefault();
      const lobbyNameInput = document.getElementById('lobbyNameInput');
      const name = lobbyNameInput.value;
      lobbyNameInput.value = '';
      fetch('/api/lobbies', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ name })
      })
        .then((response) => response.json())
        .then((data) => {
          console.log(data);
          const { message, lobbyId } = data;
          if (message === 'Lobby created successfully') {
            window.location.href = `/lobbies/${lobbyId}`;
          } else {
            console.error('Failed to create lobby:', message);
          }
        })
        .catch((error) => {
          console.error('Failed to create lobby:', error);
        });
    }

    document.getElementById('createLobbyForm').addEventListener('submit', handleCreateLobbyFormSubmit);

    socket.on('lobbyUpdated', (lobbyList) => {
      updateLobbyList(lobbyList);
    });

    fetchLobbyList();

    socket.on('connect', () => {
      console.log('Connected to websocket server');
    });

    socket.on('disconnect', () => {
      console.log('Disconnected from websocket server');
    });
  </script>
</body>
</html>